<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>奇瑞商用车数字服务价值体系</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <style>
        /* 页面头部样式 */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
            background-color: #00796b;
            position: relative;
        }

        .main-title {
            font-size: 24px;
            color: white;
            margin: 0 0 10px 0;
            font-weight: bold;
        }

        .sub-title {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
        }

        /* 返回按钮样式 */
        .back-button {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            text-decoration: none;
            font-size: 14px;
        }

        .back-button:hover {
            text-decoration: underline;
        }

        /* 页面布局 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }

        .page-layout {
            display: flex;
            max-width: 1800px;
            margin: 0 auto;
            gap: 30px;
            padding: 0 30px;
            align-items: flex-start;
        }

        /* 左侧内容区域 */
        .content-left {
            flex: 3;
            display: flex;
            gap: 30px;
        }

        /* 右侧权重计算区域 */
        .content-right {
            flex: 1;
            padding: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* 左侧标题栏 */
        .title-column {
            width: 150px;
            display: flex;
            flex-direction: column;
        }

        /* 左侧虚线框 */
        .title-box {
            border: 2px dashed #004d99;
            height: 60px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #004d99;
            font-size: 14px;
            background: white;
            box-sizing: border-box;
        }

        /* 主要内容区 */
        .main-content {
            flex: 1;
        }

        /* 价值分类行 */
        .category-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 20px;
        }

        .category-item {
            flex: 1;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            text-align: center;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            color: #004d99;
            font-weight: bold;
            box-sizing: border-box;
        }

        /* 一级维度组合框 */
        .primary-box-group {
            background: white;
            border: 1px solid #004d99;
            border-radius: 4px;
            height: 60px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #004d99;
            font-size: 14px;
            box-sizing: border-box;
            padding: 0 15px;
        }

        /* 价值维度网格 */
        .value-grid {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .value-column {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* 二级框容器 */
        .secondary-boxes {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* 二级框 */
        .secondary-box {
            background: white;
            padding: 10px;
            text-align: center;
            border: 1px solid #004d99;
            border-radius: 4px;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        /* 评分输入框 */
        .score-input {
            width: 60px;
            padding: 4px;
            text-align: center;
            border: 1px solid #004d99;
            border-radius: 4px;
        }

        /* 计算按钮 */
        .calculate-btn {
            width: 80%;
            margin: 20px 0;
        }

        /* 图表容器 */
        .chart-container {
            width: 100%;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- 页面头部 -->
    <div class="page-header">
        <a href="index.html" class="back-button">返回首页</a>
        <h1 class="main-title">奇瑞商用车数字服务价值体系</h1>
        <div class="sub-title">价值评估表</div>
    </div>

    <div class="page-layout">
        <!-- 左侧内容区域 -->
        <div class="content-left">
            <!-- 左侧标题栏 -->
            <div class="title-column">
                <div class="title-box">价值分类</div>
                <div class="title-box">价值维度一级</div>
                <div class="title-box">价值维度二级</div>
            </div>

            <!-- 主要内容区 -->
            <div class="main-content">
                <!-- 价值分类行 -->
                <div class="category-row">
                    <div class="category-item">行业影响</div>
                    <div class="category-item">客户影响</div>
                    <div class="category-item">环境影响</div>
                    <div class="category-item">商业价值</div>
                </div>

                <!-- 价值维度网格 -->
                <div class="value-grid">
                    <!-- 行业影响列 -->
                    <div class="value-column">
                        <div class="primary-box-group">
                            安全性 | 舒适性 | 可用性 | 品质
                        </div>
                        <div class="secondary-boxes">
                            <!-- 安全性 -->
                            <div class="secondary-box" data-category="行业影响">
                                车辆安全
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="行业影响">
                                信息安全
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="行业影响">
                                智能驾驶安全
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <!-- 舒适性 -->
                            <div class="secondary-box" data-category="行业影响">
                                空间利用率
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="行业影响">
                                承载性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="行业影响">
                                适应性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <!-- 可用性 -->
                            <div class="secondary-box" data-category="行业影响">
                                耐用性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="行业影响">
                                可靠性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="行业影响">
                                设计感
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <!-- 品质 -->
                            <div class="secondary-box" data-category="行业影响">
                                易用性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="行业影响">
                                友好性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- 客户影响列 -->
                    <div class="value-column">
                        <div class="primary-box-group">
                            客制化 | 便利性 | 数智化
                        </div>
                        <div class="secondary-boxes">
                            <!-- 客制化 -->
                            <div class="secondary-box" data-category="客户影响">
                                个性化
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="客户影响">
                                偏好性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="客户影响">
                                场景化
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <!-- 便利性 -->
                            <div class="secondary-box" data-category="客户影响">
                                主动便利性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="客户影响">
                                生态便利
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <!-- 数智化 -->
                            <div class="secondary-box" data-category="客户影响">
                                人工智能
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="客户影响">
                                产业互联
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="客户影响">
                                移动端互联
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="客户影响">
                                车辆端互联
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- 环境影响列 -->
                    <div class="value-column">
                        <div class="primary-box-group">
                            环保
                        </div>
                        <div class="secondary-boxes">
                            <div class="secondary-box" data-category="环境影响">
                                低碳
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="环境影响">
                                能源有效性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="环境影响">
                                循环性
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- 商业价值列 -->
                    <div class="value-column">
                        <div class="primary-box-group">
                            营利性
                        </div>
                        <div class="secondary-boxes">
                            <div class="secondary-box" data-category="商业价值">
                                成本控制
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="商业价值">
                                效率
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                            <div class="secondary-box" data-category="商业价值">
                                省时
                                <input type="number" class="score-input" min="0" max="10" value="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧权重计算区域 -->
        <div class="content-right">
            <button class="calculate-btn" onclick="calculateWeights()">计算价值偏好</button>
            <div class="chart-container">
                <canvas id="weightChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // 注册数据标签插件
        Chart.register(ChartDataLabels);
        
        let myChart = null;

        // 层次分析法的判断矩阵一致性比率指标
        const RI = {
            1: 0, 2: 0, 3: 0.58, 4: 0.90, 5: 1.12, 6: 1.24, 7: 1.32, 8: 1.41, 9: 1.45
        };

        function calculateWeights() {
            // 二级维度权重系数
            const secondaryWeights = {
                '营利性': 1,
                '环保': 1,
                '客制化': 0.0859,
                '便利性': 0.0430,
                '数智化': 0.0106,
                '安全性': 0.0218,
                '可用性': 0.0166,
                '品质': 0.0143,
                '舒适性': 0.0098
            };

            // 价值分类权重系数
            const categoryWeights = {
                '商业价值': 0.4067,
                '环境影响': 0.3913,
                '客户影响': 0.1395,
                '行业影响': 0.0625
            };

            // 收集并计算加权分数
            const weightedScores = {
                '商业价值': 0,
                '环境影响': 0,
                '客户影响': 0,
                '行业影响': 0
            };

            // 记录每个分类下的二级维度数量
            const categoryCount = {
                '商业价值': 0,
                '环境影响': 0,
                '客户影响': 0,
                '行业影响': 0
            };

            // 遍历所有输入框
            document.querySelectorAll('.secondary-box').forEach(box => {
                const category = box.dataset.category;
                const input = box.querySelector('.score-input');
                const score = parseFloat(input.value) || 0;
                
                // 获取二级维度名称（从box的文本内容中提取）
                const dimensionName = box.textContent.trim().split('\n')[0];
                
                // 应用二级维度权重
                let weightedScore = score;
                if (secondaryWeights[dimensionName]) {
                    weightedScore *= secondaryWeights[dimensionName];
                }
                
                // 累加到对应分类
                if (category) {
                    weightedScores[category] += weightedScore;
                    categoryCount[category]++;
                }
            });

            // 计算每个分类的平均加权分数
            for (let category in weightedScores) {
                if (categoryCount[category] > 0) {
                    weightedScores[category] = weightedScores[category] / categoryCount[category];
                    // 应用价值分类权重
                    weightedScores[category] *= categoryWeights[category];
                }
            }

            // 计算总分
            const total = Object.values(weightedScores).reduce((a, b) => a + b, 0);

            // 计算最终权重百分比
            const data = Object.entries(weightedScores).map(([category, score]) => ({
                category: category,
                weight: total > 0 ? (score / total * 100).toFixed(2) : 0
            }));

            // 更新饼图
            if (myChart) {
                myChart.destroy();
            }

            const ctx = document.getElementById('weightChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.map(item => item.category),
                    datasets: [{
                        data: data.map(item => item.weight),
                        backgroundColor: [
                            '#FF6384', // 商业价值
                            '#36A2EB', // 环境影响
                            '#FFCE56', // 客户影响
                            '#4BC0C0'  // 行业影响
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            formatter: function(value, context) {
                                return `${value}%`;
                            },
                            anchor: 'center',
                            align: 'center',
                            offset: 0
                        }
                    }
                }
            });

            console.log('加权分数：', weightedScores);
            console.log('最终权重百分比：', data);
        }

        // 为所有输入框添加验证
        document.querySelectorAll('.score-input').forEach(input => {
            input.addEventListener('input', function() {
                let value = parseFloat(this.value);
                if (value < 0) this.value = 0;
                if (value > 10) this.value = 10;
            });
        });
    </script>
</body>
</html>
